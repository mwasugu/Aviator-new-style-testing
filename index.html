<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aviator Data Analyzer (Simulation)</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #121212; color: #e0e0e0; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background-color: #1e1e1e; padding: 20px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); }
        h1, h2 { color: #bb86fc; border-bottom: 1px solid #333; padding-bottom: 10px; margin-top: 20px; }
        input[type="number"], button, .input-control button, .input-control .toggle { padding: 10px; margin: 5px 0; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s, transform 0.1s; }
        input[type="number"] { background-color: #333; color: #fff; width: 100%; box-sizing: border-box; }
        button:hover { transform: translateY(-1px); }
        .red-round { background-color: #ff3d5e; color: white; }
        .green-round { background-color: #4CAF50; color: white; }
        .orange-round { background-color: #FF9800; color: black; font-weight: bold; }
        .round-item { display: inline-block; padding: 4px 8px; margin: 3px; border-radius: 3px; font-size: 0.9em; }

        /* Vifaa vya Kudhibiti */
        .input-control { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        .mic-btn { background-color: #03dac6; color: black; font-weight: bold; font-size: 1.2em; padding: 10px 15px; }
        .mic-btn:hover { background-color: #03a89a; }
        .toggle-btn { background-color: #333; color: white; font-size: 0.75em; padding: 5px 8px; }
        .toggle-btn.active { background-color: #6200ee; }

        /* Display Indicators */
        .indicator { background-color: #2c2c2c; padding: 10px; border-radius: 5px; margin-bottom: 10px; font-size: 1.1em; }
        #cycle-time { font-size: 1.2em; font-weight: bold; color: #03dac6; }
        #algorithm-status { font-weight: bold; padding: 8px; border-radius: 5px; background-color: #373737; }
        
        /* Error Reset */
        #error-reset-btn { background-color: #cf6679; color: white; width: 100%; }
        #error-reset-btn:hover { background-color: #b00020; }
        
        /* Historia */
        #history-display { border: 1px solid #333; padding: 10px; max-height: 200px; overflow-y: auto; background-color: #2c2c2c; }
        #delete-last-btn { background-color: #f44336; color: white; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="indicator">
            Mzunguko wa Uchambuzi: <span id="cycle-time">Inahesabu...</span>
        </div>

        <div class="indicator">
            Hali ya Algoriti: <span id="algorithm-status">Inaanza...</span>
        </div>

        ---

        <h2>üéØ Learn Mode & Risk Assessment</h2>
        
        <div class="input-control">
            <input type="number" id="multiplier-input" placeholder="Ingiza Multiplier (e.g., 2.45)" step="0.01" min="1.00">
            <button id="submit-btn" onclick="submitMultiplier()">Ingiza</button>
            <button id="mic-btn" class="mic-btn">üéôÔ∏è</button>
            <button id="voice-toggle-btn" class="toggle-btn" title="Automatic Voice Input">Auto üé§ OFF</button>
        </div>
        
        <div class="indicator" id="risk-display">
            Hatari ya Kawaida: **Tathmini...** | Jackpot Probability: **0%**
        </div>

        ---

        <h2>‚ö†Ô∏è Error Management</h2>
        <div class="indicator">
            Makosa Ya Kujifunza (1.00x - 1.30x): <span id="error-count">0</span>
        </div>
        <button id="error-reset-btn" onclick="resetError()">Punguza Kosa Moja (Adjust $J\_Counter$)</button>

        ---

        <h2>üìú Round History</h2>
        <button id="delete-last-btn" onclick="deleteLastRound()">Futa Round ya Mwisho (Kama Ulikosea)</button>
        
        <div id="history-display">
            </div>
    </div>
    <script>
        // Vigezo vya Msingi (Constants)
        const CYCLE_DURATION_MS = 11 * 60 * 1000; // Dakika 11 katika milisekunde
        const ERROR_THRESHOLD = 1.30;
        const JACKPOT_THRESHOLD = 10.00;
        
        // Vigezo vya Hali (State Variables)
        let roundHistory = [];
        let errorCount = 0;
        let isVoiceContinuous = false;
        let recognition = null; // Kwa Speech Recognition

        // --- Mwanzo: Usimamizi wa Data (LocalStorage) ---

        /** Inapakia data zote kutoka kwa kivinjari (localStorage) */
        function loadData() {
            const storedHistory = localStorage.getItem('aviator_history');
            const storedErrors = localStorage.getItem('aviator_errors');
            
            if (storedHistory) {
                try {
                    roundHistory = JSON.parse(storedHistory);
                } catch (e) {
                    console.error("Kosa la kupakia historia:", e);
                    roundHistory = []; // Rudisha utupu
                }
            }
            errorCount = storedErrors ? parseInt(storedErrors) : 0;
            
            // Sasisha UI
            document.getElementById('error-count').textContent = errorCount;
            renderHistory();
        }

        /** Inahifadhi data zote kwa kivinjari */
        function saveData() {
            localStorage.setItem('aviator_history', JSON.stringify(roundHistory));
            localStorage.setItem('aviator_errors', errorCount);
        }

        // --- Mwisho: Usimamizi wa Data ---

        // --- Mwanzo: Cycle Logic & Time Display ---

        let cycleStartTime = Date.now(); // Muda wa kuanza wa mzunguko
        
        /** Inasasisha muda wa mzunguko na Risk Assessment (kwa sekunde 60) */
        function updateCycleTime() {
            const now = Date.now();
            const elapsed = now - cycleStartTime;
            
            // Ikiwa mzunguko umekwisha (dakika 11)
            if (elapsed >= CYCLE_DURATION_MS) {
                cycleStartTime = now; // Anzisha mzunguko mpya
            }
            
            const remaining = CYCLE_DURATION_MS - (now - cycleStartTime);
            const minutes = Math.floor(remaining / 60000);
            const seconds = Math.floor((remaining % 60000) / 1000);
            
            const elapsedMins = Math.floor(elapsed / 60000);
            const elapsedSecs = Math.floor((elapsed % 60000) / 1000);

            document.getElementById('cycle-time').textContent = 
                `${String(elapsedMins).padStart(2, '0')}:${String(elapsedSecs).padStart(2, '0')} / 11:00`;
            
            // Fanya Risk Assessment ya Muda wa Mzunguko
            // Simu ya utendaji bora zaidi: (Angalia sehemu ya Algorithm Core)
            runRiskAssessment();
        }
        
        setInterval(updateCycleTime, 1000); // Sasisha kila sekunde 1

        // --- Mwisho: Cycle Logic ---

        // --- Mwanzo: Learn Mode & Algorithm Core ---

        /** HUU NDIO MSINGI WA ALGORITI YAKO */
        function runRiskAssessment() {
            const now = Date.now();
            // 1. **Uchambuzi wa Hatari ya Kawaida:**
            // Hapa ingiza mantiki ya kuchambua historia ya mizunguko ya zamani (roundHistory)
            // ambayo ilitokea katika dirisha la sekunde 60 linalofanana na muda wa sasa.
            // Tumia 'roundHistory.filter()' kwa utendaji.

            // 2. **Jackpot Assessment (Adaptive Algorithm):**
            // Pata muda/idadi ya mizunguko tangu JACKPOT ya mwisho.
            const lastJackpotIndex = roundHistory.findIndex(r => r.multiplier >= JACKPOT_THRESHOLD);
            const roundsSinceJackpot = lastJackpotIndex !== -1 ? roundHistory.length - 1 - lastJackpotIndex : roundHistory.length;
            
            let jackpotProbability = 0;
            let riskStatus = "Inachambua...";

            // Hili ni mfano rahisi. Unahitaji kuboresha hapa!
            if (roundsSinceJackpot > 50) { // Tuseme wastani wa nadharia ni 50
                jackpotProbability = Math.min(100, Math.floor((roundsSinceJackpot - 50) * 2)); 
                riskStatus = "HATARI KUBWA (Kiasi ya Chini)!";
            } else if (roundsSinceJackpot > 30) {
                 jackpotProbability = Math.floor(roundsSinceJackpot * 1.5);
                 riskStatus = "Tahadhari! (Wastani wa Chini)";
            } else {
                jackpotProbability = roundsSinceJackpot * 0.5;
                riskStatus = "Salama Kiasi.";
            }

            document.getElementById('risk-display').innerHTML = 
                `Hatari ya Kawaida: **${riskStatus}** | Jackpot Probability: **${jackpotProbability}%**`;
            
            // Sasisha Hali ya Algoriti
            document.getElementById('algorithm-status').textContent = 
                `Jackpot Counter: ${roundsSinceJackpot}. ${riskStatus}`;
        }

        /** Inashughulikia multiplier mpya iliyoingizwa */
        function submitMultiplier() {
            const inputElement = document.getElementById('multiplier-input');
            const multiplierStr = inputElement.value;
            const multiplier = parseFloat(multiplierStr);

            if (isNaN(multiplier) || multiplier < 1.00) {
                alert("Tafadhali ingiza multiplier halali (‚â• 1.00).");
                return;
            }

            // 1. Hifadhi Historia
            roundHistory.push({ 
                multiplier: multiplier, 
                timestamp: Date.now(), 
                cycleTime: document.getElementById('cycle-time').textContent 
            });

            // 2. Learn Mode: Kuhesabu Makosa
            if (multiplier <= ERROR_THRESHOLD) {
                errorCount++;
                document.getElementById('error-count').textContent = errorCount;
            }
            
            // 3. Sasisha UI na Data
            renderHistory();
            saveData();
            runRiskAssessment(); // Endesha tena uchambuzi na data mpya
            
            // Safisha input
            inputElement.value = '';
            inputElement.focus();
        }

        // --- Mwisho: Learn Mode & Algorithm Core ---
        
        // --- Mwanzo: History & Error UI Management ---

        /** Inafuta round ya mwisho kutoka kwenye historia */
        function deleteLastRound() {
            if (roundHistory.length === 0) return;
            
            const lastRound = roundHistory.pop();
            
            // Rekebisha Error Count (kwa ajili ya kujirekebisha)
            if (lastRound.multiplier <= ERROR_THRESHOLD) {
                 errorCount = Math.max(0, errorCount - 1);
                 document.getElementById('error-count').textContent = errorCount;
            }
            
            saveData();
            renderHistory();
            runRiskAssessment();
        }

        /** Inapunguza kosa moja kutoka kwenye mfumo */
        function resetError() {
            if (errorCount > 0) {
                errorCount--;
                document.getElementById('error-count').textContent = errorCount;
                saveData();
                runRiskAssessment(); // Hii inaweza kubadilisha Jackpot Probability
            }
        }
        
        /** Inachora Historia ya Round kwenye UI */
        function renderHistory() {
            const display = document.getElementById('history-display');
            display.innerHTML = ''; // Safisha kwanza
            
            // Chora historia kuanzia ya mwisho (iliyopita)
            roundHistory.slice().reverse().forEach(round => {
                let className = '';
                if (round.multiplier >= JACKPOT_THRESHOLD) {
                    className = 'orange-round';
                } else if (round.multiplier >= 2.00) {
                    className = 'green-round';
                } else {
                    className = 'red-round';
                }
                
                const span = document.createElement('span');
                span.className = `round-item ${className}`;
                span.textContent = `${round.multiplier.toFixed(2)}x`; // Fixed to 2 decimal places
                display.appendChild(span);
            });
        }
        
        // --- Mwisho: History & Error UI Management ---

        // --- Mwanzo: Speech Recognition (Voice Input) ---
        
        /** Inatekeleza Voice Recognition API */
        function setupVoiceRecognition() {
            // Angalia kama kivinjari kinaauni (supports) Speech Recognition
            if (!('webkitSpeechRecognition' in window)) {
                alert("Samahani, kivinjari chako hakiauni (support) Voice Input.");
                document.getElementById('mic-btn').disabled = true;
                document.getElementById('voice-toggle-btn').disabled = true;
                return;
            }
            
            recognition = new webkitSpeechRecognition();
            recognition.lang = 'en-US'; // Tumia Kiingereza kwa nambari (rahisi kutafsiri)
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;
            
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                // Ondoa maneno yasiyo ya lazima na badilisha "point" au "dot" na "."
                let cleanTranscript = transcript.toLowerCase().replace(/point|dot/g, '.').replace(/\s/g, ''); 
                
                // Jaribu kupata nambari halali (e.g., "one.threefour" -> "1.34")
                const match = cleanTranscript.match(/(\d+(\.\d+)?)/);
                
                if (match) {
                    document.getElementById('multiplier-input').value = match[0];
                    if (!isVoiceContinuous) {
                       submitMultiplier(); // Ingiza moja kwa moja kama siyo mode ya continuous
                    }
                }
            };

            recognition.onerror = function(event) {
                console.error('Voice Recognition Error:', event.error);
            };

            recognition.onend = function() {
                if (isVoiceContinuous) {
                    // Anza tena kusikiliza katika continuous mode
                    recognition.start();
                }
            };
        }

        /** Inabadilisha hali ya Voice Toggle */
        document.getElementById('voice-toggle-btn').addEventListener('click', function() {
            isVoiceContinuous = !isVoiceContinuous;
            this.classList.toggle('active', isVoiceContinuous);
            this.textContent = isVoiceContinuous ? 'Auto üé§ ON' : 'Auto üé§ OFF';
            recognition.continuous = isVoiceContinuous; // Muhimu kwa continuous mode
            recognition.stop(); // Acha na uanze tena na mipangilio mipya
            if (isVoiceContinuous) {
                recognition.start();
            }
        });
        
        /** Kitufe cha Sauti kinachofanya kazi kwa kubonyeza mara moja */
        document.getElementById('mic-btn').addEventListener('click', function() {
            if (!isVoiceContinuous) {
                recognition.start();
            }
        });
        
        // --- Mwisho: Speech Recognition ---

        // --- Uanzishaji wa Mfumo (Initialization) ---
        window.onload = function() {
            loadData(); // Pakia historia na makosa
            updateCycleTime(); // Anza kuhesabu muda
            setupVoiceRecognition(); // Tayarisha voice input
        };
        // --- Mwisho: Uanzishaji ---
    </script>
</body>
</html>
